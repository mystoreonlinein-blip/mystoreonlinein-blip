:root {
  color-scheme: light;
  font-family: "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont,
    "Segoe UI", sans-serif;
  /* Approximate height of the features lead line above the grid */
  --features-lead-h: 36px;
}

*, *::before, *::after { box-sizing: border-box; }

html {
  overflow-y: scroll;
  /* Force scrollbar to always show on Windows/Linux */
  min-height: 100%;
  height: auto;
}

body { margin: 0; color: #1d1d1f; }

.visually-hidden { position: absolute !important; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }

.features__lead { max-width: 1120px; margin: 0 auto; padding: 0.5rem 1rem 0.25rem; color: rgba(29,29,31,0.75); }

.features {
  display: grid;
  grid-template-columns: minmax(260px, 260px) minmax(0, 1fr);
  gap: 1rem;
  max-width: 1120px;
  margin: 0 auto;
  padding: 1rem;
  /* Fill viewport minus fixed header, footer, and small lead text above */
  min-height: calc(100svh - var(--header-h) - var(--footer-h) - var(--features-lead-h) + 100px);
  align-items: start;
  width: 100%;
}

/* Sidebar tree */
.features__sidebar {
  position: sticky;
  top: var(--header-h);
  align-self: start;
  width: 260px;
  min-width: 260px;
  max-width: 260px;
  flex-shrink: 0;
}
.tree { user-select: none; width: 260px; min-width: 260px; max-width: 260px; }
.tree__list, .tree__children { list-style: none; padding-left: 0; margin: 0; width: 100%; }
.tree__list > li { margin-bottom: 0.5rem; width: 100%; }

.tree__toggle {
  appearance: none; -webkit-appearance: none; border: 0; background: transparent;
  color: rgba(29,29,31,0.9); font-weight: 600; cursor: pointer; padding: 0.25rem 0; display: inline-flex; align-items: center; gap: 0.4rem;
}
.tree__toggle::before { content: "\25BE"; /* ▼ */ transform-origin: center; }
.tree__toggle[aria-expanded="false"]::before { content: "\25B8"; /* ▸ */ }

.tree__children { margin: 0.35rem 0 0 0.75rem; border-left: 1px dashed rgba(29,29,31,0.2); padding-left: 0.75rem; }
.tree__children.is-collapsed { display: none; }

.tree__link {
  display: block;
  padding: 0.25rem 0.4rem;
  color: rgba(29,29,31,0.85);
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 400;
  position: relative;
  white-space: normal;
  word-wrap: break-word;
  line-height: 1.4;
  isolation: isolate;
}
.tree__link::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 8px;
  background: transparent;
  z-index: -1;
  pointer-events: none;
}
.tree__link:hover::before { background: rgba(29,29,31,0.08); }
.tree__link.is-active::before { background: rgba(29,29,31,0.12); }

/* Content */
.features__content {
  padding: 1rem 1.5rem 2rem;
  min-height: calc(100svh - var(--header-h) - var(--footer-h) - var(--features-lead-h) - 2rem);
}
.feature-section { max-width: 720px; }
.feature-section h1 {
  margin: 0.25rem 0 1.5rem;
  font-size: clamp(1.6rem, 4.5vw, 2rem);
  font-weight: 600;
  padding-bottom: 0.75rem;
  border-bottom: 2px solid rgba(29,29,31,0.1);
}
.feature-section h2 {
  margin-top: 2rem;
  font-size: 1.25rem;
  color: rgba(29,29,31,0.9);
}
.feature-section p {
  color: rgba(29,29,31,0.8);
  line-height: 1.6;
  margin-bottom: 1rem;
}
.feature-section[hidden] { display: none; }

/* Lists styling */
.feature-section ul,
.feature-section ol {
  margin: 1rem 0;
  padding-left: 1.5rem;
}
.feature-section li {
  margin-bottom: 0.5rem;
  line-height: 1.6;
  color: rgba(29,29,31,0.8);
}

/* Info callout boxes */
.info-box {
  background: rgba(29,29,31,0.04);
  border-left: 4px solid #007aff;
  padding: 1rem 1.25rem;
  margin: 1.5rem 0;
  border-radius: 0 8px 8px 0;
}

/* Table styling */
.feature-section table {
  width: 100%;
  border-collapse: collapse;
  margin: 1.5rem 0;
  font-size: 0.95rem;
}
.feature-section th,
.feature-section td {
  padding: 0.75rem 1rem;
  text-align: left;
  border-bottom: 1px solid rgba(29,29,31,0.1);
}
.feature-section th {
  background: rgba(29,29,31,0.04);
  font-weight: 600;
  color: rgba(29,29,31,0.9);
}
.feature-section tr:hover td {
  background: rgba(29,29,31,0.02);
}

/* Image containers */
.feature-section img {
  margin-top: 1rem;
}

/* Responsive: stack on narrow screens */
@media (max-width: 880px) {
  .features { grid-template-columns: 1fr; }
  .features__sidebar { position: static; }
}

/* Image Lightbox */
.lightbox-modal {
  display: none;
  position: fixed;
  z-index: 9999;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.lightbox-modal.active {
  display: flex;
}

.lightbox-content {
  max-width: 90%;
  max-height: 90%;
  object-fit: contain;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

.lightbox-close {
  position: absolute;
  top: 20px;
  right: 40px;
  color: #fff;
  font-size: 40px;
  font-weight: bold;
  cursor: pointer;
  background: none;
  border: none;
  padding: 0;
  line-height: 1;
  transition: opacity 0.2s;
}

.lightbox-close:hover {
  opacity: 0.7;
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  body { color: #f5f5f7; }
  .tree__toggle { color: #f5f5f7; }
  .tree__children { border-left-color: rgba(245,245,247,0.2); }
  .tree__link { color: rgba(245,245,247,0.85); }
  .tree__link:hover::before { background: rgba(245,245,247,0.12); }
  .tree__link.is-active::before { background: rgba(245,245,247,0.16); }

  /* Feature section dark mode */
  .feature-section h1 {
    border-bottom-color: rgba(245,245,247,0.1);
  }
  .feature-section h2 {
    color: rgba(245,245,247,0.9);
  }
  .feature-section p,
  .feature-section li {
    color: rgba(245,245,247,0.8);
  }
  .info-box {
    background: rgba(245,245,247,0.04);
  }
  .feature-section th {
    background: rgba(245,245,247,0.06);
    color: rgba(245,245,247,0.9);
  }
  .feature-section th,
  .feature-section td {
    border-bottom-color: rgba(245,245,247,0.1);
  }
  .feature-section tr:hover td {
    background: rgba(245,245,247,0.02);
  }
}
